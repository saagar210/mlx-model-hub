# Local k3d development configuration
# Resource limits optimized for M4 Pro (48GB RAM)

namespace: langfuse

# Langfuse Web Server
langfuse:
  web:
    replicas: 2
    image: langfuse/langfuse:3
    resources:
      requests:
        cpu: "250m"
        memory: "512Mi"
      limits:
        cpu: "500m"
        memory: "1Gi"
    env:
      NODE_ENV: production
      LANGFUSE_LOG_LEVEL: info
      # Feature flags
      LANGFUSE_ENABLE_EXPERIMENTAL_FEATURES: "true"

  worker:
    replicas: 2
    image: langfuse/langfuse-worker:3
    resources:
      requests:
        cpu: "500m"
        memory: "1Gi"
      limits:
        cpu: "1000m"
        memory: "2Gi"

# PostgreSQL - Metadata storage
postgresql:
  enabled: true
  image: postgres:16-alpine
  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"
    limits:
      cpu: "1000m"
      memory: "2Gi"
  storage:
    size: 10Gi
    storageClass: local-path
  auth:
    database: langfuse
    username: langfuse
    # Password should be set via secret in production
    password: langfuse-local-dev

# ClickHouse - Analytics storage
clickhouse:
  enabled: true
  image: clickhouse/clickhouse-server:24.3
  resources:
    requests:
      cpu: "1000m"
      memory: "2Gi"
    limits:
      cpu: "2000m"
      memory: "4Gi"
  storage:
    size: 30Gi
    storageClass: local-path
  retention:
    # 7-day retention for local development
    days: 7

# Redis - Caching layer
redis:
  enabled: true
  image: redis:7-alpine
  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "250m"
      memory: "512Mi"

# LocalStack - S3-compatible blob storage for traces
localstack:
  enabled: true
  image: localstack/localstack:3
  resources:
    requests:
      cpu: "250m"
      memory: "512Mi"
    limits:
      cpu: "500m"
      memory: "1Gi"
  storage:
    size: 10Gi
    storageClass: local-path
  services:
    - s3
  s3:
    bucketName: langfuse-traces

# Service exposure
service:
  web:
    type: ClusterIP
    port: 3000
  postgresql:
    type: ClusterIP
    port: 5432
  clickhouse:
    type: ClusterIP
    port: 8123
  localstack:
    type: ClusterIP
    port: 4566

# Authentication
auth:
  # Generate these with: openssl rand -base64 32
  nextauthSecret: "local-dev-secret-change-in-production"
  salt: "local-dev-salt-change-in-production"
  # Initial admin user
  adminEmail: admin@localhost
  adminPassword: admin123

# Ingress (disabled for local - using k3d port forwarding)
ingress:
  enabled: false

# Monitoring
monitoring:
  prometheus:
    enabled: true
    scrapeInterval: 30s
  serviceMonitor:
    enabled: true
